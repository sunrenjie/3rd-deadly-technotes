<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>How To: Cross compiling libraries for iOS&nbsp;(armv6/armv7/i386)</title>
</head>

<body>
<div id="page">
<div class="content">
	<div id="middlecolumn">
		<div id="primary">	
				<div id="primarycontent" class="hfeed">
<div id="post-24" class="post-24 post type-post status-publish format-standard hentry category-how-to category-ios category-programming tag-bash tag-cross-compiling tag-how-to-2 tag-ios-2 tag-leptonica tag-ocr tag-programming-2 tag-tesseract p publish author-tinsukesuzuki y2011 m02 d17 h12">
	<div class="entry-head">
	<h3 class="entry-title">How To: Cross compiling libraries for iOS&nbsp;(armv6/armv7/i386)</h3>
	<p>Feb 17, 2011</p><p>Stolen from <a href="http://tinsuke.wordpress.com/2011/02/17/how-to-cross-compiling-libraries-for-ios-armv6armv7i386/">here</a>.</p>
		<div class="entry-meta">
			<div class="meta-row">
				<span class="authordata">By <span class="vcard author"><a href="http://tinsuke.wordpress.com/author/tinsukesuzuki/" class="url fn">Suzuki</a></span></span>				<a href="http://tinsuke.wordpress.com/2011/02/17/how-to-cross-compiling-libraries-for-ios-armv6armv7i386/#comments" class="commentslink" title="Comment on How To: Cross compiling libraries for iOS&nbsp;(armv6/armv7/i386)">64&nbsp;<span>Comments</span></a>			</div>
			<div class="meta-row">
				<span class="entry-category">Categories: <a href="http://tinsuke.wordpress.com/category/how-to/" title="View all posts in How To">How To</a>, <a href="http://tinsuke.wordpress.com/category/programming/ios/" title="View all posts in iOS">iOS</a> and <a href="http://tinsuke.wordpress.com/category/programming/" title="View all posts in Programming">Programming</a></span>				<br><span class="entry-category">Tags: <a href="http://tinsuke.wordpress.com/tag/bash/" rel="tag">bash</a>, <a href="http://tinsuke.wordpress.com/tag/cross-compiling/" rel="tag">cross compiling</a>, <a href="http://tinsuke.wordpress.com/tag/how-to-2/" rel="tag">how to</a>, <a href="http://tinsuke.wordpress.com/tag/ios-2/" rel="tag">ios</a>, <a href="http://tinsuke.wordpress.com/tag/leptonica/" rel="tag">leptonica</a>, <a href="http://tinsuke.wordpress.com/tag/ocr/" rel="tag">ocr</a>, <a href="http://tinsuke.wordpress.com/tag/programming-2/" rel="tag">programming</a>, <a href="http://tinsuke.wordpress.com/tag/tesseract/" rel="tag">tesseract</a><br></span>			</div>

		</div> <!-- .entry-meta -->
	</div> <!-- .entry-head -->

	<div class="entry-content">
		<h2>Update</h2>
<ul>
<li>If you wanna compile and use Tesseract &nbsp;3.01 on Xcode 4.2 with iOS SDK 5, check my new post <a title="How To: Compile and Use Tesseract (3.01) on iOS (SDK&nbsp;5)" href="http://tinsuke.wordpress.com/2011/11/01/how-to-compile-and-use-tesseract-3-01-on-ios-sdk-5/">“How To: Compile and Use Tesseract (3.01) on iOS (SDK 5)”</a>.</li>

</ul>
<p>So, if you’re a smart programmer, when you get asked to solve some new problem (“new” in the “I’ve never done this before” sense) you head over to Chrome (not Opera/Firefox, as I stated earlier, you’re SMART, not FASHION or OUTDATED), hit “CTRL + L” and start typing some keywords related to your problem, hit ENTER and wait for the amazing amount of resources Google (not Bing, because, as I stated earlier, you’re a programmer, not a no-brains) will hand you.</p>
<p>Among those resources, if you’re lucky enough, you’ll find out an OpenSource library that claims to solve exactly, or at least a piece of, your problem. This Library has binary downloadable packages for almost every OS you can imagine and even for OpenSolaris BUT, if you’re a mobile App developer (Android/iOS), they won’t give a <del>fck!ng d@mn $h!t</del> binary for your target OS.</p>
<p>Well, at this point, if you’re in a good day and helped that old lady cross the street a couple of hours earlier, this Library will be ready to compile through one configure script named, ehrm… “configure”.</p>
<p>If you’ve made it through here, maybe I can save your day. I’ve prepared one Bash script that is able to cross-compile one (or more) Static Library in different architectures (armv6/armv7/i386) and pack all different lib*.a into one single FAT FILE (or Universal Binary) so you can link against the same file when compiling for iPhone3G/3GS/4/Simulator.</p>
<p><span id="more-24"></span></p>
<p>Before we get our hands dirty, I’d like to clarify that:</p>
<ul>
<li>Armv6 binaries are needed if you’re targeting iPhone3G (yes, they still exist, <a href="http://twitter.com/#%21/igornandrade" target="_blank">my</a> <a href="http://www.linkedin.com/profile/view?id=25463136" target="_blank">co-worker</a> <a href="http://www.facebook.com/igornandrade" target="_blank">uses one</a>, can u believe it?);</li>

<li>Armv7 binaries are desirable if you’re targeting iPhone3GS/4 or iPad, since these new toys have Armv7 processors and, besides being able to rum Armv6 binaries, they probably will have a better performance using the better Armv7 architecture;</li>
<li>i386 binares are needed if you intent to run your code at the Simulator (ok, it is needed, right?!).</li>
</ul>
<h2>Let’s get this party started! (or: Compiling)</h2>
<p>Basically, for each architecture, we’ll be:</p>
<ol>
<li>Pre-configuring the environment: setting some environment variables to values related to our current arch;</li>
<li>Configuring the library through its own “configure” script;</li>
<li>Compiling the library, hell yeah!</li>
</ol>

<p>For explanation, I’ll be compiling the Leptonica and Tesseract-OCR libraries. My folder structure for this script is the following:</p>
<ul>
<li>./ – root dir</li>
<li>./dependencies/ – folder where the final binary and headers will be placed;</li>
<li>./leptonlib-1.67 – folder with the sources of the first library I wanna compile;</li>
<li>./opencv/ – folder with the sources of the second library (that depends on the first one) I wanna compile;</li>
<li>./build_dependencies.sh – the bash script I’m explaining you.</li>
</ul>
<p>Initially we’ll be setting some globals:</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_538537"><div class="bar             "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><a class="item printSource" style="width: 16px; height: 16px;" title="print" href="#printSource">print</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash plain">GLOBAL_OUTDIR=</code><code class="bash string">"`pwd`/dependencies"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $GLOBAL_OUTDIR/include $GLOBAL_OUTDIR/lib</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="bash plain">OUTDIR=</code><code class="bash string">"./outdir"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="bash plain">LEPTON_LIB=</code><code class="bash string">"`pwd`/leptonlib-1.67"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="bash plain">TESSERACT_LIB=</code><code class="bash string">"`pwd`/tesseract_ocr"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="bash plain">IOS_BASE_SDK=</code><code class="bash string">"4.2"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="bash plain">IOS_DEPLOY_TGT=</code><code class="bash string">"3.2"</code></td></tr></tbody></table></div></div></div>

<ul>
<li>$GLOBAL_OUTDIR is a common folder where includes and lib files from every library will be put into;</li>
<li>$OUTDIR is a folder name where, inside each lib dir, we’ll be putting the lib files that library generates, before moving them to the global one;</li>
<li>$LEPTON_LIB and $TESSERACT_LIB are the libraries I’m compiling;</li>
<li>$IOS_BASE_SDK is the iOS SDK version you’re compiling against;</li>
<li>$IOS_DEPLOY_TGT the iOS SDK minimum version you’ll allow your App to run.</li>
</ul>
<p>Then, we’ll define a common function to be used for all architectures:</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_200205"><div class="bar      "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><a class="item printSource" style="width: 16px; height: 16px;" title="print" href="#printSource">print</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="bash plain">setenv_all()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="bash plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments"># Add internal libs</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CFLAGS=</code><code class="bash string">"$CFLAGS -I$GLOBAL_OUTDIR/include -L$GLOBAL_OUTDIR/lib"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CPP=</code><code class="bash string">"$DEVROOT/usr/bin/cpp-4.2"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CXX=</code><code class="bash string">"$DEVROOT/usr/bin/g++-4.2"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CXXCPP=</code><code class="bash string">"$DEVROOT/usr/bin/cpp-4.2"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CC=</code><code class="bash string">"$DEVROOT/usr/bin/gcc-4.2"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">LD=$DEVROOT/usr/bin/ld</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">AR=$DEVROOT/usr/bin/ar</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">AS=$DEVROOT/usr/bin/as</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">NM=$DEVROOT/usr/bin/nm</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">RANLIB=$DEVROOT/usr/bin/ranlib</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">LDFLAGS=</code><code class="bash string">"-L$SDKROOT/usr/lib/"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CPPFLAGS=$CFLAGS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CXXFLAGS=$CFLAGS</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="bash plain">}</code></td></tr></tbody></table></div></div></div>

<p>Note that $GLOBAL_OUTDIR is used as an include path (include sub-directory) and library path (lib sub-directory) so that if one of the libraries you’re compiling depend on each other (which is my case), they can link against each other.</p>
<p>And, finally a setenv function for each architecture:</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_604832"><div class="bar           "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="bash plain">setenv_arm6()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="bash plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">unset</code> <code class="bash plain">DEVROOT SDKROOT CFLAGS CC LD CPP CXX AR AS NM CXXCPP RANLIB LDFLAGS CPPFLAGS CXXFLAGS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">DEVROOT=/Developer/Platforms/iPhoneOS.platform/Developer</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">SDKROOT=$DEVROOT/SDKs/iPhoneOS$IOS_BASE_SDK.sdk</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CFLAGS=</code><code class="bash string">"-arch armv6 -pipe -no-cpp-precomp -isysroot $SDKROOT -miphoneos-version-min=$IOS_DEPLOY_TGT -I$SDKROOT/usr/include/"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">setenv_all</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="bash plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="bash plain">setenv_arm7()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="bash plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">unset</code> <code class="bash plain">DEVROOT SDKROOT CFLAGS CC LD CPP CXX AR AS NM CXXCPP RANLIB LDFLAGS CPPFLAGS CXXFLAGS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">DEVROOT=/Developer/Platforms/iPhoneOS.platform/Developer</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">SDKROOT=$DEVROOT/SDKs/iPhoneOS$IOS_BASE_SDK.sdk</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CFLAGS=</code><code class="bash string">"-arch armv7 -pipe -no-cpp-precomp -isysroot $SDKROOT -miphoneos-version-min=$IOS_DEPLOY_TGT -I$SDKROOT/usr/include/"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">setenv_all</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="bash plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="bash plain">setenv_i386()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="bash plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">unset</code> <code class="bash plain">DEVROOT SDKROOT CFLAGS CC LD CPP CXX AR AS NM CXXCPP RANLIB LDFLAGS CPPFLAGS CXXFLAGS</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">DEVROOT=/Developer/Platforms/iPhoneSimulator.platform/Developer</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">SDKROOT=$DEVROOT/SDKs/iPhoneSimulator$IOS_BASE_SDK.sdk</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">export</code> <code class="bash plain">CFLAGS=</code><code class="bash string">"-arch i386 -pipe -no-cpp-precomp -isysroot $SDKROOT -miphoneos-version-min=$IOS_DEPLOY_TGT"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">setenv_all</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content"><code class="bash plain">}</code></td></tr></tbody></table></div></div></div>

<p>Just to follow the file structure, I’ll be dropping these functions now, they are responsible for merging lib*.a files from different architectures into a single one (using lipo) and merging lib*.a files from the same architecture into a single one (this one was particularly useful for my case, so you can skip it):</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_212587"><div class="bar        "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><a class="item printSource" style="width: 16px; height: 16px;" title="print" href="#printSource">print</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="bash plain">create_outdir_lipo()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="bash plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">for</code> <code class="bash plain">lib_i386 </code><code class="bash keyword">in</code> <code class="bash plain">`</code><code class="bash functions">find</code> <code class="bash plain">$OUTDIR/i386 -name </code><code class="bash string">"lib*\.a"</code><code class="bash plain">`; </code><code class="bash keyword">do</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">lib_arm6=`</code><code class="bash functions">echo</code> <code class="bash plain">$lib_i386 | </code><code class="bash functions">sed</code> <code class="bash string">"s/i386/arm6/g"</code><code class="bash plain">`</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">lib_arm7=`</code><code class="bash functions">echo</code> <code class="bash plain">$lib_i386 | </code><code class="bash functions">sed</code> <code class="bash string">"s/i386/arm7/g"</code><code class="bash plain">`</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">lib=`</code><code class="bash functions">echo</code> <code class="bash plain">$lib_i386 | </code><code class="bash functions">sed</code> <code class="bash string">"s/i386\///g"</code><code class="bash plain">`</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">lipo -arch armv6 $lib_arm6 -arch armv7 $lib_arm7 -arch i386 $lib_i386 -create -output $lib</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">done</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="bash plain">}</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="bash plain">merge_libfiles()</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="bash plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">DIR=$1</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">LIBNAME=$2</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">cd</code> <code class="bash plain">$DIR</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">for</code> <code class="bash plain">i </code><code class="bash keyword">in</code> <code class="bash plain">`</code><code class="bash functions">find</code> <code class="bash plain">. -name </code><code class="bash string">"lib*.a"</code><code class="bash plain">`; </code><code class="bash keyword">do</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">$AR -x $i</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">done</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">$AR -r $LIBNAME *.o</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">rm</code> <code class="bash plain">-rf *.o __*</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">cd</code> <code class="bash plain">-</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="bash plain">}</code></td></tr></tbody></table></div></div></div>

<p>Now that we’ve defined all the functions we’ll need, let’s compile the first library!</p>
<h2>Leptonica</h2>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_598627"><div class="bar "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash comments">#######################</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="bash comments"># LEPTONLIB</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="bash comments">#######################</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="bash functions">cd</code> <code class="bash plain">$LEPTON_LIB</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="bash functions">rm</code> <code class="bash plain">-rf $OUTDIR</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $OUTDIR/arm6 $OUTDIR/arm7 $OUTDIR/i386</code></td></tr></tbody></table></div></div></div>

<p>Enter the library subdir, remove any old built files and re-create the $OUTDIR dir structure.</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_495661"><div class="bar "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">clean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">distclean 2&gt; /dev/null</code></td></tr></tbody></table></div></div></div>

<p>Clean anything that might have happened earlier.</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_272799"><div class="bar "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash plain">setenv_arm6</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="bash plain">./configure --host=arm-apple-darwin6 --</code><code class="bash functions">enable</code><code class="bash plain">-shared=no --disable-programs --without-zlib --without-libpng --without-jpeg --without-giflib --without-libtiff</code></td></tr></tbody></table></div></div></div>
<p>Configure the environment for Armv6 architecture and call the library configure script. The following parameters are very important:</p>
<ul>
<li>–host=arm-apple-darwin6: Defines the architecture;</li>

<li>–enable-shared=no: Builds the library as a statical one, since we can’t use dynamically linked libraries on iOS Applications;</li>
<li>The other ones are specific for this project and suited to my preferences.</li>
</ul>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_344410"><div class="bar "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">-j4</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="bash functions">cp</code> <code class="bash plain">-rvf src/.libs/lib*.a $OUTDIR/arm6</code></td></tr></tbody></table></div></div></div>

<p>Compiles the library in 4 separated tasks (faster and recommended on Core2Duo processors) and copies the generates lib*.a files to the architecture specific $OUTDIR subfolder.</p>
<p>It is very important to notice that your library may generate the Library files (lib*.a) in a different folder, so it is advisable that, after “make -j4″, you issue the following command to find your lib*.a files:</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_27695"><div class="bar"></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash functions">find</code> <code class="bash plain">. -name </code><code class="bash string">"lib*.a"</code></td></tr></tbody></table></div></div></div>
<p>If your lib*.a files are in a different location, change the cp command argument “src/.libs/lib*.a” to your different location.</p>
<p>After this, we repeat the commands (with the appropriated different arguments) for the other architectures:</p>

<p></p><div class="syntaxhighlighter  bash" id="highlighter_565388"><div class="bar "><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">clean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">distclean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="bash plain">setenv_arm7</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="bash plain">./configure --host=arm-apple-darwin7 --</code><code class="bash functions">enable</code><code class="bash plain">-shared=no --disable-programs --without-zlib --without-libpng --without-jpeg --without-giflib --without-libtiff</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">-j4</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="bash functions">cp</code> <code class="bash plain">-rvf src/.libs/lib*.a $OUTDIR/arm7</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">clean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">distclean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="bash plain">setenv_i386</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="bash plain">./configure --</code><code class="bash functions">enable</code><code class="bash plain">-shared=no --disable-programs --without-zlib --without-libpng --without-jpeg --without-giflib --without-libtiff</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">-j4</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="bash functions">cp</code> <code class="bash plain">-rvf src/.libs/lib*.a $OUTDIR/i386</code></td></tr></tbody></table></div></div></div>

<p>And now, let’s get to what we want: get the library files!</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_492812"><div class="bar"><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><a class="item printSource" style="width: 16px; height: 16px;" title="print" href="#printSource">print</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash plain">create_outdir_lipo</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $GLOBAL_OUTDIR/include/leptonica &amp;&amp; </code><code class="bash functions">cp</code> <code class="bash plain">-rvf src/*.h $GLOBAL_OUTDIR/include/leptonica</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $GLOBAL_OUTDIR/lib &amp;&amp; </code><code class="bash functions">cp</code> <code class="bash plain">-rvf $OUTDIR/lib*.a $GLOBAL_OUTDIR/lib</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="bash functions">cd</code> <code class="bash plain">-</code></td></tr></tbody></table></div></div></div>

<p>Create a FAT file (by the “lipo” tool… interesting) containing the binaries for the 3 archs, copy the desired Header files (.h) to the leptonica include folder inside $GLOBAL_OUTDIR and copy the generated FAT file to $GLOBAL_OUTDIR/lib.</p>
<p>Well, if you’re interested in compiling a single library, this is it! But, OpenSource libraries often are using another OpenSource libraries… what happened to be my case. So let’s get to the second one:</p>
<h2>Tesseract-OCR</h2>
<p>This is the library I REALLY want compiled.</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_46278"><div class="bar"><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><a class="item printSource" style="width: 16px; height: 16px;" title="print" href="#printSource">print</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="bash comments">#######################</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="bash comments"># TESSERACT-OCR (v3)</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="bash comments">#######################</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="bash functions">cd</code> <code class="bash plain">$TESSERACT_LIB</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="bash functions">rm</code> <code class="bash plain">-rf $OUTDIR</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $OUTDIR/arm6 $OUTDIR/arm7 $OUTDIR/i386</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">clean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">distclean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="bash plain">setenv_arm6</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="bash plain">./configure --host=arm-apple-darwin6 --</code><code class="bash functions">enable</code><code class="bash plain">-shared=no --without-libtiff --with-liblepto=</code><code class="bash string">"$GLOBAL_OUTDIR/include/leptonica"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">-j4</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="bash keyword">for</code> <code class="bash plain">i </code><code class="bash keyword">in</code> <code class="bash plain">`</code><code class="bash functions">find</code> <code class="bash plain">. -name </code><code class="bash string">"lib*.a"</code><code class="bash plain">`; </code><code class="bash keyword">do</code> <code class="bash functions">cp</code> <code class="bash plain">-rvf $i $OUTDIR/arm6; </code><code class="bash keyword">done</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="bash plain">merge_libfiles $OUTDIR/arm6 libtesseract_all.a</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>15</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>16</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">clean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>17</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">distclean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>18</code></td><td class="content"><code class="bash plain">setenv_arm7</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>19</code></td><td class="content"><code class="bash plain">./configure --host=arm-apple-darwin7 --</code><code class="bash functions">enable</code><code class="bash plain">-shared=no --without-libtiff --with-liblepto=</code><code class="bash string">"$GLOBAL_OUTDIR/include/leptonica"</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>20</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">-j4</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>21</code></td><td class="content"><code class="bash keyword">for</code> <code class="bash plain">i </code><code class="bash keyword">in</code> <code class="bash plain">`</code><code class="bash functions">find</code> <code class="bash plain">. -name </code><code class="bash string">"lib*.a"</code> <code class="bash plain">| </code><code class="bash functions">grep</code> <code class="bash plain">-</code><code class="bash functions">v</code> <code class="bash plain">arm`; </code><code class="bash keyword">do</code> <code class="bash functions">cp</code> <code class="bash plain">-rvf $i $OUTDIR/arm7; </code><code class="bash keyword">done</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>22</code></td><td class="content"><code class="bash plain">merge_libfiles $OUTDIR/arm7 libtesseract_all.a</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>23</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">clean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>24</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">distclean 2&gt; /dev/null</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>25</code></td><td class="content"><code class="bash plain">setenv_i386</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>26</code></td><td class="content"><code class="bash plain">./configure --</code><code class="bash functions">enable</code><code class="bash plain">-shared=no --without-libtiff --with-liblepto=</code><code class="bash string">"$GLOBAL_OUTDIR/include/leptonica"</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>27</code></td><td class="content"><code class="bash functions">make</code> <code class="bash plain">-j4</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>28</code></td><td class="content"><code class="bash keyword">for</code> <code class="bash plain">i </code><code class="bash keyword">in</code> <code class="bash plain">`</code><code class="bash functions">find</code> <code class="bash plain">. -name </code><code class="bash string">"lib*.a"</code> <code class="bash plain">| </code><code class="bash functions">grep</code> <code class="bash plain">-</code><code class="bash functions">v</code> <code class="bash plain">arm`; </code><code class="bash keyword">do</code> <code class="bash functions">cp</code> <code class="bash plain">-rvf $i $OUTDIR/i386; </code><code class="bash keyword">done</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>29</code></td><td class="content"><code class="bash plain">merge_libfiles $OUTDIR/i386 libtesseract_all.a</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>30</code></td><td class="content">&nbsp;</td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>31</code></td><td class="content"><code class="bash plain">create_outdir_lipo</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>32</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $GLOBAL_OUTDIR/include/tesseract &amp;&amp; </code><code class="bash functions">cp</code> <code class="bash plain">-rvf api/apitypes.h api/baseapi.h ccmain/thresholder.h ccstruct/publictypes.h ccutil/ocrclass.h ccutil/unichar.h</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>33</code></td><td class="content"><code class="spaces">&nbsp;</code><code class="bash plain">$GLOBAL_OUTDIR/include/tesseract</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>34</code></td><td class="content"><code class="bash functions">mkdir</code> <code class="bash plain">-p $GLOBAL_OUTDIR/lib &amp;&amp; </code><code class="bash functions">cp</code> <code class="bash plain">-rvf $OUTDIR/lib*.a $GLOBAL_OUTDIR/lib</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>35</code></td><td class="content"><code class="bash functions">cd</code> <code class="bash plain">-</code></td></tr></tbody></table></div></div></div>

<p>Note that here I use “merge_libfiles”. The reason is that tesseract generates 15 (FIFTEEN!!!) libtesseract_*.a files, so I merge them into a single libtesseract_all.a.</p>
<p>It is also worthy to note that I’m using the custom configure argument:</p>
<p></p><div class="syntaxhighlighter  bash" id="highlighter_207149"><div class="bar"><div class="toolbar"><a class="item viewSource" style="width: 16px; height: 16px;" title="view source" href="#viewSource">view source</a><a class="item printSource" style="width: 16px; height: 16px;" title="print" href="#printSource">print</a><a class="item about" style="width: 16px; height: 16px;" title="?" href="#about">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="bash plain">--with-liblepto=</code><code class="bash string">"$GLOBAL_OUTDIR/include/leptonica"</code></td></tr></tbody></table></div></div></div>
<p>I had to modify the original configure script for tesseract v3.01 since it requires leptonica BUT would only check if it was present on your machine library paths and, since we’re not compiling for our machine, but to iOS architectures, it wouldn’t find a suitable leptonica to link against. The changes I’ve made are fairly simple and I’m making the modified file available as well.</p>
<h2>Project Configuration</h2>
<p>Now you have the include .h files and the libraries .a files, what about including ‘em at your project? Open Xcode and do as explained:</p>

<ol>
<li>Add the .h files as you would include any other source files: right-click your project at ” Groups and Files” -&gt; Add -&gt; Existing Files… -&gt; Select the .h files (or the containing folder). I like to keep headers/sources I add this way organized within an “External Classes” group;</li>
<li>Add the .a files so your application will link against them: at “Groups and Files”, expand Targets -&gt; Expand {YOUR_PROJECT_NAME} -&gt;Right-click Link With Binaries -&gt; Add -&gt; Existing Files… -&gt; Select the .a files;</li>

<li>Also, our pre-compiled libraries are generated with the <a href="http://stackoverflow.com/questions/3739783/iphone-gcc-llvm-gcc-or-llvm" target="_blank">better LLVM compiler</a>, so we’ll set our application project to use LLVM <strong>and</strong> GCC so we can use libraries compiled with both compilers: at “Groups and Files”, double-click your project -&gt; At Tab Build -&gt; At Section Compiler Version -&gt; Change C/C++ Compiler Version to: LLVM GCC 4.2.</li>
</ol>
<p>That’s it, now you should be able to compile and run your own application.</p>
<h2>Files for Download!</h2>

<p>I really hope to be helping someone out there (let me know if so…) (really, I can get motivated to help out MORE):</p>
<ul>
<li><a href="http://goo.gl/OuP7f" target="_blank">build_dependencies.sh</a>: Cross compiling script that I’ve created -&nbsp;<a title="Cross compiling script that I've created" href="http://goo.gl/OuP7f" target="_blank">http://goo.gl/OuP7f</a></li>
<li><a href="http://goo.gl/iLOeR" target="_blank">configure</a>: Modified script for compiling Tesseract v3.01 for iOS -&nbsp;<a title="Modified script for compiling Tesseract v3.01 for iOS" href="http://goo.gl/iLOeR" target="_blank">http://goo.gl/iLOeR</a></li>
<li><a href="http://goo.gl/Z4Grl" target="_blank">opencv_leptonica_tesseract_ios_42.zip</a>: Headers and Libraries files for OpenCV, Leptonica and Tesseract (iOS 4.2)</li>
</ul>
<h2>Acknowledgements</h2>

<ul>
<li><a href="http://gravatar.com/qliedtke" target="_blank">Quentin Liedtke</a>: For the <a href="http://tinsuke.wordpress.com/2011/02/17/how-to-cross-compiling-libraries-for-ios-armv6armv7i386/#comment-7">‘mkdir -p’ correction</a></li>
<li>Benjamin Ng: For the <a href="http://tinsuke.wordpress.com/2011/02/17/how-to-cross-compiling-libraries-for-ios-armv6armv7i386/#comment-11">binaries providing hint</a></li>
<li><a href="http://gravatar.com/0fcb75145de5f78c6c48536002ac5ae4" target="_blank">venusbai</a>: For the <a href="http://tinsuke.wordpress.com/2011/02/17/how-to-cross-compiling-libraries-for-ios-armv6armv7i386/#comment-48" target="_blank">‘leptonlib/-1.67′ correction</a> (how did you find that?!)</li>
</ul>
</body></html>

